 

<br>

# ğŸ“ **ìƒê´€ê´€ê³„ ë¶„ì„ (Correlation Analysis)**  

ë‘ ê°œì˜ ë³€ìˆ˜ê°€ ì„œë¡œ ê´€ë ¨ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.

<br>

## ê³µë¶„ì‚°

ë³€ìˆ˜ê°€ í•˜ë‚˜ì¼ ë•Œ ë¶„ì‚°ì€ ê±°ë¦¬ì™€ ê´€ë ¨ì´ ìˆë‹¤.  
ë³€ìˆ˜ê°€ ë‘ê°œì¼ ë•ŒëŠ” ê±°ë¦¬ì™€ ë°©í–¥ì„ ê°–ê²Œ ëœë‹¤.


```py
import numpy as np

print(np.var(np.arange(1, 6)))
print(np.var(np.arange(2, 7)))

print(np.cov(np.arange(1,6), np.arange(2,7)))
print(np.cov(np.arange(1,6), (3,3,3,3,3)))
print(np.cov(np.arange(1,6), np.arange(6,1,-1)))

x = [8,3,6,6,9,4,3,9,3,4]
print('xí‰ê· :', np.mean(x))
print('xë¶„ì‚°:', np.var(x))
print()

y = [6,2,4,6,9,5,1,8,4,5]
print('yí‰ê· :', np.mean(y))
print('yë¶„ì‚°:', np.var(y))
print()

#ê³µë¶„ì‚°
print('xì™€ yì˜ ê³µë¶„ì‚° í–‰ë ¬:', np.cov(x,y))
print('xì™€ yì˜ ê³µë¶„ì‚°:', np.cov(x,y)[0, 1])
```


ë‘ í™•ë¥ ë³€ìˆ˜ê°€ ì–‘ì˜ ìƒê´€ê´€ê³„ë¥¼ ê°–ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê³µë¶„ì‚°ë§Œìœ¼ë¡œëŠ” ìƒê´€ê´€ê³„ê°€ ì–¼ë§ˆë‚˜ ê°•í•œ ì§€, í˜¹ì€ ì•½í•œ ì§€ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤. ë‹¨ìœ„ì— ë”°ë¼ ê³µë¶„ì‚°ì˜ í¬ê¸°ê°€ ë‹¬ë¼ì§€ë¯€ë¡œ ì ˆëŒ€ì  í¬ê¸°ë¡œëŠ” íŒë‹¨ì´ ì–´ë µë‹¤.   
-> ìƒê´€ê³„ìˆ˜ë¡œ ë¹„êµí•˜ì—¬ íŒë‹¨í•œë‹¤. ê³µë¶„ì‚°ì„ í‘œì¤€í™”í•œ ê²ƒì´ ìƒê´€ê³„ìˆ˜ì´ë‹¤. ìƒê´€ê³„ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ í™•ì¸í•˜ë©´ ìƒê´€ê´€ê³„ì˜ ê°•ë„(ì„¸ê¸°)ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.

<br>

## ìƒê´€ê³„ìˆ˜ 

ìƒê´€ê´€ê³„ì˜ ë°©í–¥ê³¼ ì„¸ê¸°ë¥¼ ëª¨ë‘ ì•Œ ìˆ˜ ìˆë‹¤.  

r = Xì™€ Yê°€ í•¨ê»˜ ë³€í•˜ëŠ” ì •ë„ (ê³µë¶„ì‚°) / Xì™€ Yê°€ ê°ê° ë³€í•˜ëŠ” ì •ë„ (ê°ê°ì˜ ë¶„ì‚°)

ì¼ë°˜ì ìœ¼ë¡œ  
rì´ -1.0ê³¼ -0.7 ì‚¬ì´ì´ë©´, ê°•í•œ ìŒì  ì„ í˜•ê´€ê³„,  
rì´ -0.7ê³¼ -0.3 ì‚¬ì´ì´ë©´, ëšœë ·í•œ ìŒì  ì„ í˜•ê´€ê³„,  
rì´ -0.3ê³¼ -0.1 ì‚¬ì´ì´ë©´, ì•½í•œ ìŒì  ì„ í˜•ê´€ê³„,  
rì´ -0.1ê³¼ +0.1 ì‚¬ì´ì´ë©´, ê±°ì˜ ë¬´ì‹œë  ìˆ˜ ìˆëŠ” ì„ í˜•ê´€ê³„,  
rì´ +0.1ê³¼ +0.3 ì‚¬ì´ì´ë©´, ì•½í•œ ì–‘ì  ì„ í˜•ê´€ê³„,  
rì´ +0.3ê³¼ +0.7 ì‚¬ì´ì´ë©´, ëšœë ·í•œ ì–‘ì  ì„ í˜•ê´€ê³„,  
rì´ +0.7ê³¼ +1.0 ì‚¬ì´ì´ë©´, ê°•í•œ ì–‘ì  ì„ í˜•ê´€ê³„


```py
print('xì™€ yì˜ ìƒê´€ê³„ìˆ˜ í–‰ë ¬:', np.corrcoef(x,y))
print('xì™€ yì˜ ìƒê´€ê³„ìˆ˜:', np.corrcoef(x,y)[0,1])
```

<br>

## ì‹œê°í™”ë¡œ ë¶„í¬ í™•ì¸ 


```py
import matplotlib.pyplot as plt

plt.plot(x, y, 'o')
plt.show()
```

<br>

## ë°ì´í„°ê°€ ë¹„ì„ í˜•ì¼ ê²½ìš° (ê³¡ì„ í˜•íƒœ)

```py
m = [-3,-2,-1,0,1,2,3]
n = [9,4,1,0,1,4,9]

print(np.cov(m,n)[0,1])
print(np.corrcoef(m,n)[0,1])

plt.plot(m, n, 'o')
plt.show()
```

ìƒê´€ê³„ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì„ í˜•ë°ì´í„°ë¡œë¶€í„° êµ¬í•  ìˆ˜ ìˆë‹¤. ë¹„ì„ í˜•ì¼ ë•ŒëŠ” ê³µë¶„ì‚°ê³¼ ìƒê´€ê´€ê³„ìˆ˜ ì¸¡ì •ì´ ê³¤ë€í•˜ë‹¤.  

Pearson ìƒê´€ ê³„ìˆ˜ëŠ” ì„ í˜• ê´€ê³„ë§Œ ì¸¡ì •í•˜ê³  Spearman ìƒê´€ê³„ìˆ˜ëŠ” ë‹¨ìˆœ ê´€ê³„ë§Œ ì¸¡ì •í•œë‹¤.  
ìƒê´€ê³„ìˆ˜ê°€ 0ì´ì–´ë„ ì˜ë¯¸ ìˆëŠ” ê´€ê³„ê°€ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. 
ê·¸ëŸ¬ë¯€ë¡œ ì‚°ì ë„ë¥¼ í†µí•´ ë¶„í¬ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤.

<br>

## ğŸ’¡ ì‹¤ìŠµ 1) ì¹œë°€ë„ì™€ ì ì ˆì„±ì— ë”°ë¥¸ ë§Œì¡±ë„


```py
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

df = pd.read_csv('/content/drive/MyDrive/testdata/drinking_water.csv')
print(df.head(3))
print(df.describe())

#í‘œì¤€í¸ì°¨
print(np.std(df.ì¹œë°€ë„))
print(np.std(df.ì ì ˆì„±))
print(np.std(df.ë§Œì¡±ë„))

plt.hist([np.std(df.ì¹œë°€ë„), np.std(df.ì ì ˆì„±), np.std(df.ë§Œì¡±ë„)])
plt.show()
```

<br>

### ê³µë¶„ì‚°  


```py
print(np.cov(df.ì¹œë°€ë„, df.ì ì ˆì„±))  #np.cov()ëŠ” ì¸ìˆ˜ë¥¼ ë‘ ê°œë§Œ ê°€ì§
print(np.cov(df.ì¹œë°€ë„, df.ë§Œì¡±ë„))
print()

print(df.cov())
```

<br>

### ìƒê´€ê³„ìˆ˜  


```py
print(np.corrcoef(df.ì¹œë°€ë„, df.ì ì ˆì„±))
print(np.corrcoef(df.ì¹œë°€ë„, df.ë§Œì¡±ë„))
print()

print(df.corr())
print(df.corr(method='pearson'))   #ë³€ìˆ˜ê°€ ë“±ê°„, ë¹„ìœ¨ì²™ë„. ì •ê·œì„±ì„ ë”°ë¦„
print(df.corr(method='spearman'))  #ë³€ìˆ˜ê°€ ì„œì—´ì²™ë„
print(df.corr(method='kendall'))   #spearmanê³¼ ìœ ì‚¬
```

<br>

### ë§Œì¡±ë„ì— ëŒ€í•œ ë‹¤ë¥¸ íŠ¹ì„± ì‚¬ì´ì˜ ìƒê´€ê´€ê³„ íŒŒì•…  


```py
coRe = df.corr()

print(coRe['ë§Œì¡±ë„'].sort_values(ascending=False))
```

<br>

### ì‹œê°í™”

```py
import matplotlib.pyplot as plt
plt.rc('font', family='NanumBarunGothic')
plt.rcParams['axes.unicode_minus'] = False

df.plot(kind='scatter', x='ë§Œì¡±ë„', y='ì ì ˆì„±')
plt.show()
```
```py
from pandas.plotting import scatter_matrix
attr = ['ì¹œë°€ë„','ì ì ˆì„±','ë§Œì¡±ë„']
scatter_matrix(df[attr], figsize = (10, 6))
plt.show()

import seaborn as sns
sns.heatmap(df.corr())
plt.show()
```

```py
corr = df.corr()
mask = np.zeros_like(corr, dtype=np.bool)
mask[np.triu_indices_from(mask)] = True
vmax = np.abs(corr.values[~mask]).max()

fig, ax = plt.subplots()
sns.heatmap(corr, mask=mask, vmin=-vmax, vmax=vmax, square=True, linecolor='lightgray', linewidths=1, ax=ax)

for i in range(len(corr)):
  ax.text(i + 0.5, len(corr) - (i + 0.5), corr.columns[i], ha = 'center', va = 'center', rotation = 45)
  for j in range(i + 1, len(corr)):
    s = '{:.3f}'.format(corr.values[i, j])
    ax.text(j + 0.5, len(corr) - (i + 0.5), s, ha = 'center', va = 'center')

ax.axis('off')
plt.show()
```

<br>

## ğŸ’¡ ì‹¤ìŠµ 2) ë‚˜ë¼ë³„ ì™¸êµ­ì¸ ë°©ë¬¸ê° ìˆ˜   

êµ­ë‚´ ìœ ë£Œê´€ê´‘ì§€ì— ëŒ€í•´ ì™¸êµ­ì¸ (ì¼ë³¸, ì¤‘êµ­, ë¯¸êµ­) ë°©ë¬¸ìë£Œë¡œ 


```py
import json
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

def setScatterChart(tour_table, all_table, tourPoint):
  tour = tour_table[tour_table['resNm'] == tourPoint]
  #print(tour)  #201101   ì°½ë•ê¶   14137  ë°©ë¬¸ë‚ ì§œ, ë°©ë¬¸ì§€, ë°©ë¬¸ê±´ìˆ˜

  merge_table = pd.merge(tour, all_table, left_index=True, right_index=True)
  #print(merge_table)

  #ì‹œê°í™”
  fig = plt.figure()
  fig.suptitle(tourPoint + ' ìƒê´€ê´€ê³„ ë¶„ì„')

  ##ì¤‘êµ­
  plt.subplot(1, 3, 1)
  plt.xlabel('ì¤‘êµ­ì¸ ì…êµ­ìˆ˜')
  plt.ylabel('ì™¸êµ­ì¸ ì…ì¥ê°ìˆ˜')
  lamb1 = lambda p:merge_table['china'].corr(merge_table['ForNum'])
  r1 = lamb1(merge_table)
  print('r1:', r1)
  plt.title('r={:.5f}'.format(r1))
  plt.scatter(merge_table['china'], merge_table['ForNum'], s=6, c='red')
  #plt.show()

  ##ì¼ë³¸
  plt.subplot(1, 3, 1)
  plt.xlabel('ì¼ë³¸ì¸ ì…êµ­ìˆ˜')
  plt.ylabel('ì™¸êµ­ì¸ ì…ì¥ê°ìˆ˜')
  lamb2 = lambda p:merge_table['japan'].corr(merge_table['ForNum'])
  r2 = lamb2(merge_table)
  print('r2:', r2)
  plt.title('r={:.5f}'.format(r2))
  plt.scatter(merge_table['japan'], merge_table['ForNum'], s=6, c='blue')
  #plt.show()

  ##ë¯¸êµ­
  plt.subplot(1, 3, 1)
  plt.xlabel('ë¯¸êµ­ì¸ ì…êµ­ìˆ˜')
  plt.ylabel('ì™¸êµ­ì¸ ì…ì¥ê°ìˆ˜')
  lamb3 = lambda p:merge_table['usa'].corr(merge_table['ForNum'])
  r3 = lamb3(merge_table)
  print('r3:', r3)
  plt.title('r={:.5f}'.format(r3))
  plt.scatter(merge_table['usa'], merge_table['ForNum'], s=6, c='yellow')

  plt.tight_layout()
  plt.show()

  return [tourPoint, r1, r2, r3]
```

```py
def startFunc():
  fname = '/content/drive/MyDrive/testdata/á„‰á…¥á„‹á…®á†¯á„á…³á†¨á„‡á…§á†¯á„‰á…µ_á„€á…ªá†«á„€á…ªá†¼á„Œá…µá„‹á…µá†¸á„Œá…¡á†¼á„Œá…¥á†¼á„‡á…©_2011_2016.json'
  jsonTP = json.loads(open(fname, 'r', encoding='utf-8').read())
  #print(jsonTP)

  tour_table = pd.DataFrame(jsonTP, columns=('yyyymm','resNm','ForNum')).set_index('yyyymm')
  #print(tour_table.head(5))

  resNm = tour_table.resNm.unique()
  #print(resNm)
  #print('ê´€ê´‘ì§€ëª…:', resNm[:5])  #ë‹¤ì„¯ ê°€ì§€ë§Œ

  #ì¤‘êµ­ì¸ ë°©ë¬¸ ê´€ê´‘ì§€ ì •ë³´
  cjson = '/content/drive/MyDrive/testdata/á„Œá…®á†¼á„€á…®á†¨á„‹á…µá†«á„‡á…¡á†¼á„†á…®á†«á„€á…¢á†¨.json'
  jdata = json.loads(open(cjson, 'r', encoding='utf-8').read())
  china_table = pd.DataFrame(jdata, columns=('yyyymm', 'visit_cnt')).set_index('yyyymm')
  china_table = china_table.rename(columns={'visit_cnt':'china'})
  #print(china_table.head(3))

  #ì¼ë³¸ì¸ ë°©ë¬¸ ê´€ê´‘ì§€ ì •ë³´
  jjson = '/content/drive/MyDrive/testdata/ì¼ë³¸á„‹á…µá†«á„‡á…¡á†¼á„†á…®á†«á„€á…¢á†¨.json'
  jdata = json.loads(open(jjson, 'r', encoding='utf-8').read())
  japan_table = pd.DataFrame(jdata, columns=('yyyymm', 'visit_cnt')).set_index('yyyymm')
  japan_table = japan_table.rename(columns={'visit_cnt':'japan'})
  #print(japan_table.head(3))

  #ë¯¸êµ­ì¸ ë°©ë¬¸ ê´€ê´‘ì§€ ì •ë³´
  ujson = '/content/drive/MyDrive/testdata/ë¯¸êµ­á„‹á…µá†«á„‡á…¡á†¼á„†á…®á†«á„€á…¢á†¨.json'
  jdata = json.loads(open(ujson, 'r', encoding='utf-8').read())
  usa_table = pd.DataFrame(jdata, columns=('yyyymm', 'visit_cnt')).set_index('yyyymm')
  usa_table = usa_table.rename(columns={'visit_cnt':'usa'})
  #print(usa_table.head(3))

  #í…Œì´ë¸” ë³‘í•©
  all_table = pd.merge(china_table, japan_table, left_index = True, right_index=True)
  all_table = pd.merge(all_table, usa_table, left_index = True, right_index=True)
  #print(all_table.head(5))

  r_list = []
  for tourPoint in resNm[:5]:
    r_list.append(setScatterChart(tour_table, all_table, tourPoint))

  r_df = pd.DataFrame(r_list, columns=['ê³ ê¶ëª…','ì¤‘êµ­','ì¼ë³¸','ë¯¸êµ­'])
  r_df = r_df.set_index('ê³ ê¶ëª…')
  print(r_df)

  r_df.plot(kind='bar', rot=50)
  plt.show()


if __name__=='__main__':
  startFunc()
```

<br>

